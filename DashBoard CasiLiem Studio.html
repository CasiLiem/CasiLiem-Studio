<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CasiLiem Studio Dashboard v68.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon-color: #3b82f6; --neon-intensity: 35px; --bg-image: url('CasiLiem_Universe_Background.jpg'); }
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; height: 100vh; width: 100vw; overflow: hidden; position: relative; display: flex; flex-direction: column; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: var(--bg-image); background-size: cover; background-position: center; opacity: 0.35; z-index: -1; }
        .glass { background: rgba(7, 10, 18, 0.8); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .section-tag { font-size: 0.6rem; font-weight: 900; letter-spacing: 0.2em; text-transform: uppercase; opacity: 0.7; }
        .tab-btn { padding: 0.8rem 1.2rem; font-size: 0.6rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.15em; border-bottom: 2px solid transparent; transition: all 0.3s; opacity: 0.4; cursor: pointer; }
        .tab-btn.active { opacity: 1; border-color: var(--neon-color); color: var(--neon-color); text-shadow: 0 0 10px var(--neon-color); }
        .tab-content { display: none; height: 100%; width: 100%; overflow: hidden; }
        .tab-content.active { display: flex !important; }
        #centerNotification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--neon-color); color: white; padding: 10px 30px; border-radius: 50px; font-weight: 900; font-size: 0.7rem; letter-spacing: 0.2em; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.2s, transform 0.2s; box-shadow: 0 0 20px var(--neon-color); }
        #centerNotification.show { opacity: 1; transform: translateX(-50%) translateY(10px); }
        .interactive-zone { position: relative; border-radius: 1.2rem; background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s; }
        .interactive-zone:hover { border-color: var(--neon-color); box-shadow: 0 0 var(--neon-intensity) var(--neon-color); }
        textarea, input { background: transparent !important; border: none !important; width: 100%; outline: none; padding: 1rem; font-size: 0.9rem; color: white; }
        select { background-color: #000000 !important; border: none !important; width: 100%; outline: none; padding: 0.8rem 1rem; font-size: 0.8rem; color: white; appearance: none; border-radius: 0.8rem; cursor: pointer; }
        .btn-action { padding: 0.8rem 1.2rem; border-radius: 0.8rem; font-weight: 800; text-transform: uppercase; font-size: 0.6rem; letter-spacing: 0.1em; transition: all 0.2s; cursor: pointer; border: none; color: white; }
        .suno-lyrics-canvas { font-size: 0.85rem; font-weight: 800; line-height: 1.4; color: #ffffff; white-space: pre-wrap; padding-bottom: 100px; columns: 2; column-gap: 4rem; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="centerNotification"></div>
    <div class="glass border-b border-white/5 p-3 flex justify-between items-center px-6 z-50 shrink-0">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3 pr-4 border-r border-white/10">
                <h1 class="text-xs font-black uppercase tracking-widest text-white">CasiLiem Studio</h1>
                <p id="storageIndicator" class="text-[8px] text-slate-500 uppercase font-bold italic tracking-widest">v68.5 GitHub Edition</p>
            </div>
            <nav class="flex gap-1">
                <button onclick="switchTab('discographie')" id="tab-discographie" class="tab-btn active">üìÇ Discographie</button>
                <button onclick="switchTab('karaoke')" id="tab-karaoke" class="tab-btn">üé§ Karaoke Lab</button>
                <button onclick="switchTab('studio')" id="tab-studio" class="tab-btn">üéôÔ∏è Studio Hub</button>
            </nav>
        </div>
        <div class="flex items-center gap-4">
            <button id="linkFileBtn" onclick="initFileHandle()" class="btn-action bg-amber-600/40 text-amber-200 border border-amber-500/30 text-[9px]">üîó Lier JSON PC (HTTPS OK)</button>
            <button onclick="confirmNeonColor()" class="btn-action bg-emerald-600/20 text-emerald-400 py-1 px-3 text-[10px]">SAVE STYLE</button>
        </div>
    </div>

    <div class="flex-1 relative overflow-hidden">
        <div id="content-discographie" class="tab-content active flex-col">
            <div class="p-8 pb-4 shrink-0 space-y-6">
                <div class="max-w-7xl mx-auto w-full flex justify-between items-center bg-black/40 p-4 rounded-2xl border border-white/5">
                    <select id="albumFilter" onchange="displayGlobalAlbumsOverview()" class="py-1 px-3 text-[10px] font-bold min-w-48 uppercase bg-black text-white rounded-lg border border-white/10"><option value="">-- Tous les Albums --</option></select>
                    <div class="flex gap-3">
                        <button onclick="document.getElementById('importFile').click()" class="btn-action bg-blue-900/40 border border-blue-500/30 text-blue-400 text-[9px]">Restaurer JSON</button>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto no-scrollbar px-8 pb-32">
                <div class="max-w-7xl mx-auto w-full">
                    <div id="overviewDisplayArea" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                </div>
            </div>
        </div>

        <div id="content-karaoke" class="tab-content bg-black/60 flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-black/40 shrink-0">
                <h2 class="section-tag text-blue-500 text-2xl font-black italic tracking-[0.3em]">KARAOKE LAB</h2>
                <div id="karaokeCurrentTitle" class="px-6 py-2 glass rounded-xl border border-blue-500/30 text-blue-400 font-black uppercase text-xs">Aucun Titre</div>
            </div>
            <div class="flex-1 flex flex-row overflow-hidden">
                <div id="karaokeDropZone" class="w-[30%] h-full p-8 border-r border-white/5 bg-black/30 flex flex-col items-center justify-center text-center">
                    <p class="section-tag text-slate-500 mb-2">Audio Storage</p>
                    <button id="kPlayBtn" onclick="toggleKaraokePlay()" class="w-20 h-20 rounded-full bg-blue-600 text-white text-3xl shadow-lg uppercase">‚ñ∂</button>
                    <audio id="kAudio"></audio>
                </div>
                <div id="karaokeLyricsView" class="flex-1 p-12 bg-black/20 no-scrollbar overflow-y-auto">
                    <div id="karaokeLyricsContent" class="suno-lyrics-canvas"></div>
                </div>
            </div>
        </div>

        <div id="content-studio" class="tab-content bg-black/40 flex-row">
            <div class="w-48 h-full flex flex-col p-6 space-y-6 border-r border-white/5 bg-black/60 shrink-0">
                <button onclick="clearFields()" class="btn-action bg-white/5 border border-white/10 text-[10px]">RAZ</button>
                <button id="saveBtn" onclick="saveToMemory()" class="btn-action bg-blue-600/40 text-blue-200 border border-blue-500/30 text-[10px]" disabled>SAUVEGARDER</button>
            </div>
            <div class="flex-1 h-full p-10 overflow-y-auto no-scrollbar">
                <div class="space-y-4">
                    <div class="interactive-zone"><input id="inArtist" placeholder="ARTISTE" class="uppercase font-black text-blue-400"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="interactive-zone"><input id="inAlbum" placeholder="ALBUM" oninput="validateSaveBtn();" class="uppercase"></div>
                        <div class="interactive-zone"><input id="inTrack" placeholder="N¬∞" class="text-center"></div>
                    </div>
                    <div class="interactive-zone"><input id="inTitle" placeholder="TITRE" oninput="validateSaveBtn();" class="uppercase font-black"></div>
                    <div class="interactive-zone"><textarea id="inLyrics" class="h-96 text-lg font-bold p-6" placeholder="PAROLES..."></textarea></div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">

    <script>
        const DB_NAME = 'CasiLiemStudioDB_v68'; 
        const STORE_CAT = 'studioData';
        const STORE_KARAOKE_AUD = 'karaokeAudio';

        let studioState = {};
        let uiStyle = { neon: '#3b82f6' };
        let albumCovers = {};
        let fileHandle = null;

        function initDB() {
            return new Promise((res) => {
                const req = indexedDB.open(DB_NAME, 1);
                req.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains(STORE_CAT)) db.createObjectStore(STORE_CAT);
                    if (!db.objectStoreNames.contains(STORE_KARAOKE_AUD)) db.createObjectStore(STORE_KARAOKE_AUD);
                };
                req.onsuccess = (e) => res(e.target.result);
            });
        }

        async function silentSync() {
            const db = await initDB();
            return new Promise((resolve) => {
                const tx = db.transaction(STORE_CAT, 'readwrite');
                const os = tx.objectStore(STORE_CAT);
                os.put(studioState, 'catalog');
                os.put(albumCovers, 'covers');
                os.put(uiStyle, 'style');
                tx.oncomplete = () => resolve();
            });
        }

        async function initFileHandle() {
            try {
                fileHandle = await window.showSaveFilePicker({
                    suggestedName: 'CasiLiem_Studio_DATA.json',
                    types: [{ description: 'JSON File', accept: {'application/json': ['.json']} }]
                });
                document.getElementById('linkFileBtn').textContent = "‚úÖ JSON PC LI√â";
                document.getElementById('linkFileBtn').className = "btn-action bg-emerald-600/40 text-emerald-200 border border-emerald-500/30 text-[9px]";
                showNotification("AUTO-SAVE PC ACTIF");
            } catch (err) { showNotification("√âCHEC LIAISON (HTTPS REQUIS)"); }
        }

        async function autoSaveToFile() {
            if (!fileHandle) return;
            try {
                const writable = await fileHandle.createWritable();
                await writable.write(JSON.stringify({ catalog: studioState, covers: albumCovers, style: uiStyle, v: "68.5" }));
                await writable.close();
                showNotification("SAVE PC OK");
            } catch (err) { console.error(err); }
        }

        async function loadPersistedData() {
            const ind = document.getElementById('storageIndicator');
            try {
                const db = await initDB();
                const tx = db.transaction(STORE_CAT, 'readonly');
                const os = tx.objectStore(STORE_CAT);
                os.get('catalog').onsuccess = (e) => { if(e.target.result) studioState = e.target.result; };
                os.get('covers').onsuccess = (e) => { if(e.target.result) albumCovers = e.target.result; };
                tx.oncomplete = () => {
                    ind.textContent = `v68.5 | ${Object.keys(studioState).length} TITRES`;
                    displayGlobalAlbumsOverview();
                };
            } catch (err) { ind.textContent = "MEMOIRE BLOQU√âE"; }
        }

        function importData(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = async (e) => {
                const d = JSON.parse(e.target.result);
                studioState = d.catalog || {};
                albumCovers = d.covers || {};
                await silentSync();
                showNotification("IMPORT R√âUSSI");
                setTimeout(() => location.reload(), 300);
            };
            reader.readAsText(file);
        }

        function displayGlobalAlbumsOverview() {
            const area = document.getElementById('overviewDisplayArea'); if(!area) return;
            const albumGroups = {};
            Object.values(studioState).forEach(s => { if(!albumGroups[s.album]) albumGroups[s.album] = { artist: s.artist }; });
            let html = "";
            Object.keys(albumGroups).forEach(alb => {
                html += `<div class="interactive-zone glass p-6">
                    <p class="text-[11px] font-black text-blue-400 uppercase">${albumGroups[alb].artist}</p>
                    <p class="text-xl font-black uppercase text-white">${alb}</p>
                    <div class="pt-4 flex flex-col gap-2">${Object.keys(studioState).filter(t=>studioState[t].album===alb).map(t=>`<button onclick="directLoadKaraoke('${t}')" class="text-left text-[10px] bg-white/5 p-2 rounded">üé§ ${t}</button>`).join('')}</div>
                </div>`;
            });
            area.innerHTML = html;
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`tab-${id}`).classList.add('active');
            document.getElementById(`content-${id}`).classList.add('active');
        }

        function showNotification(msg) {
            const n = document.getElementById('centerNotification');
            if(n) { n.textContent = msg; n.classList.add('show'); setTimeout(() => n.classList.remove('show'), 500); }
        }

        function validateSaveBtn() { document.getElementById('saveBtn').disabled = !(document.getElementById('inTitle').value && document.getElementById('inAlbum').value); }
        function directLoadKaraoke(t) { 
            switchTab('karaoke'); 
            document.getElementById('karaokeCurrentTitle').textContent = t;
            document.getElementById('karaokeLyricsContent').innerText = studioState[t].lyrics;
        }

        async function saveToMemory() {
            const t = document.getElementById('inTitle').value.trim().toUpperCase();
            studioState[t] = { artist: document.getElementById('inArtist').value.toUpperCase(), album: document.getElementById('inAlbum').value.toUpperCase(), track: document.getElementById('inTrack').value, lyrics: document.getElementById('inLyrics').value };
            await silentSync();
            if(fileHandle) await autoSaveToFile();
            displayGlobalAlbumsOverview();
            showNotification("SAUVEGARD√â");
        }

        window.onload = loadPersistedData;
        setInterval(async () => { await silentSync(); if(fileHandle) await autoSaveToFile(); }, 60000);
    </script>
</body>
</html>